<html>
  <head>
    <title> Graph </title>

    <script src="https://cdn.jsdelivr.net/npm/p5@1.5.0/lib/p5.js"></script>
    <script>

let topcolor, bottomcolor;
let canvasWidth, canvasHeight;

//Const to fetch Background Colour and Ticket Numbers
//Save Participant Number Count in local storage
const tnbc = JSON.parse(localStorage.getItem('Obj'));
const pn = localStorage.getItem('participant-number');
// console.log(tnbc);
// console.log(pn);

function setup() {
  canvasWidth = 1600;
  canvasHeight = 1200;
  createCanvas(canvasWidth, canvasHeight);
  rectMode(CENTER);
  noStroke();
}

function draw() {
  getData();
  async function getData() {
    clear();
    //Gradient LERP calculations
    background(255);
    per = (pn*100)/tnbc.tn;
    gPer = (per*300)/100;

    let gradient = drawingContext.createLinearGradient(width/2, gPer, width/2, height*0.75);
    gradient.addColorStop(1,color(148, 23, 81));
    gradient.addColorStop(0,color(86, 193, 255));

    drawingContext.fillStyle = gradient;
    rect(width/2, height/2, 900, 900);

    const response = await fetch('/api');
    const data = await response.json();

    let o1 = 0;
    let o2 = 0;
    let o3 = 0;
    let o4 = 0;
    let o5 = 0;
    let o6 = 0;
    let o7 = 0;
    let o8 = 0;
    let o9 = 0;
    let o10 = 0;
    let o11 = 0;

    //Fetch data from click events
    for (item of data){
      let color = `${item.color}`;
      let radius = `${item.radius}`;
      let lat = `${item.lat}`;
      let lon = `${item.lon}`;
      let angle = radians(`${item.ang}`);
      let v = createVector();

      //Ray calculations
      v.set(radius/2, 0);
      v.rotate(angle+HALF_PI*3);
      let x1 = width/2;
      let y1 = height/2;
      let x2 = x1 + v.x;
      let y2 = y1 + v.y;

      //If a point is within the 100 mile radius - i.e., regular rays within radii
      //Draw rays
      if(radius < 1000){  
        noFill();
        stroke(color);
        strokeWeight(3);
        line(x1, y1, x2, y2);
      }   

      else {
        noFill();
        stroke(color);
        strokeWeight(3);
        line(x1, y1, x2, y2);
      }
      //Draw centre circle
      fill(tnbc.bc);
      stroke(tnbc.bc);
      strokeWeight(3);
      circle(x1, y1, 20);
    }
    //Draw radii
    for (item of data){
      let color = `${item.color}`;
      let radius = `${item.radius}`;
      let x1 = width/2;
      let y1 = height/2;
      
      if(radius < 1000){  
        if(color == "#88FA4E"){
          o1++;
          let oPer1 = (o1 * 100)/pn; 
          let xop1 = (oPer1*255)/100;
          console.log(o1);
          console.log(oPer1);
          console.log(xop1);

          noFill();
          //add xop1 here
          stroke(136,250,78,xop1);
          strokeWeight(3);
          circle(x1, y1, radius);
        }
        else if(color == "#1DB100"){
        }

        else if(color == "#00FDFF"){
          
        }

        else if(color == "#0096FF"){
          
        }

        else if(color == "#9437FF"){
          
        }

        else if(color == "#942193"){
          
        }

        else if(color == "#FF40FF"){
          
        }

        else if(color == "#FF2F92"){
          
        }

        else if(color == "#FF9300"){
          
        }

        else if(color == "#FFFB00"){
          
        }

        else if(color == "#522E6E"){}
      }
    }
  }
  noLoop();
}
    </script>
  </head>
  <body>
    <main>
    </main>
  </body>
</html>