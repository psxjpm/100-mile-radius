<!-- //TODO: 
//Gradient percentages
//Concentric circles opacity

//Desired: 
//Make arcs not circles: https://p5js.org/reference/#/p5/arc -->
<html>
  <head>
    <title> Graph </title>

    <script src="https://cdn.jsdelivr.net/npm/p5@1.5.0/lib/p5.js"></script>
    <script>

let topcolor, bottomcolor;
let canvasWidth, canvasHeight;

//Const to fetch Background Colour and Ticket Numbers
//Save Participant Number Count in local storage
const tnbc = JSON.parse(localStorage.getItem('Obj'));
const pn = localStorage.getItem('participant-number');
// console.log(tnbc);
// console.log(pn);

function setup() {
  canvasWidth = 1600;
  canvasHeight = 1200;
  createCanvas(canvasWidth, canvasHeight);
  rectMode(CENTER);
  noStroke();
}

//FIXME: Layers need to be drawn in this order: gradient, rings, lines, centre point
function draw() {
  // clear();
  getData();
  async function getData() {
    // clear();
    //Gradient LERP calculations
    background(255);
    per = (pn*100)/tnbc.tn;
    gPer = (per*300)/100;
    // console.log(tnbc.tn);
    // console.log(gPer);
  
    // let gradient = drawingContext.createLinearGradient(width/2, height/4, width/2, height*0.75);
    let gradient = drawingContext.createLinearGradient(width/2, gPer, width/2, height*0.75);

    // The start gradient point is at x1=0, y1=0 (Makes blue change - the smaller the y the more it grows)
    // The end gradient point is at x2=0, y2=0
    gradient.addColorStop(1,color(148, 23, 81));
    gradient.addColorStop(0,color(86, 193, 255));

    drawingContext.fillStyle = gradient;
    rect(width/2, height/2, 900, 900);

    const response = await fetch('/api');
    const data = await response.json();
    
    //Fetch data from click events
    for (item of data){
      let color = `${item.color}`;
      let radius = `${item.radius}`;
      let lat = `${item.lat}`;
      let lon = `${item.lon}`;
      let angle = radians(`${item.ang}`);
      let v = createVector();

      //Ray calculations
      v.set(radius/2, 0);
      v.rotate(angle+HALF_PI*3);
      let x1 = width/2;
      let y1 = height/2;
      let x2 = x1 + v.x;
      let y2 = y1 + v.y;

      //If a point is within the 100 mile radius - i.e., regular rays within radii
      if(radius < 1000){  
        noFill();
        stroke(color);
        strokeWeight(3);
        // circle(x1, y1, radius);
        line(x1, y1, x2, y2);
      }   
      else {
        noFill();
        stroke(color);
        strokeWeight(3);
        line(x1, y1, x2, y2);
        // circle(x1, y1, radius);
      }
      fill(tnbc.bc);
      stroke(tnbc.bc);
      strokeWeight(3);
      circle(x1, y1, 20);
    }
    for (item of data){
      let color = `${item.color}`;
      let radius = `${item.radius}`;
      let x1 = width/2;
      let y1 = height/2;
      if(radius < 1000){  
        noFill();
        stroke(color);
        strokeWeight(3);
        circle(x1, y1, radius);
        // line(x1, y1, x2, y2);
      }
    }
  }
  noLoop();
}
    </script>
  </head>
  <body>
    <main>
    </main>
  </body>
</html>

